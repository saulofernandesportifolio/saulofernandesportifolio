<?php
require_once '../fixa_top/app/Model/Tramitacao.php';
require_once '../fixa_top/app/Model/Servico.php';
require_once '../fixa_top/app/Model/Produto.php';
?>

<?php

//parametros
$id_usuario = $_POST['id_usuario']; 
$id_usuario = $cripto->decodificar($id_usuario);
$id_solicitacao = $_POST['id_solicitacao'];
$revisao = $_POST['revisao'];

?>



<?php
//cria objeto
$SolicitacaoTramitacaoSiscom = new Tramitacao($id_usuario, $id_solicitacao, '', '', '', '', '', '', '', '', '', '', '', '', '');

$SolicitacaoTramitacaoSiscom->dataRecebimento = $SolicitacaoTramitacaoSiscom->buscaDataRecebimentoSolicitacao($id_solicitacao, $id_usuario, $revisao);


$idproduto = "";
$descricaoProduto = "";
$idservico = "";
$descricaoServico = "";

//verifica que tipo de solicitacao é (venda/servicos)
$buscarSolicitacaoSiscomServico=mysql_query("SELECT * FROM siscom_servicos WHERE siscom = '$id_solicitacao' AND revisao = $revisao");
if(mysql_affected_rows() > 0)
{
	$fonte = "siscom_servico";	
	$SolicitacaoTramitacaoSiscom = $SolicitacaoTramitacaoSiscom->buscaDadosSiscomServico($SolicitacaoTramitacaoSiscom, $id_solicitacao, $revisao);

	$Servico = new Servico();
	$Servico = $Servico->buscaServicoByDescricao($Servico, $SolicitacaoTramitacaoSiscom->servico);


	$idservico = $Servico->id_servico;
	$descricaoServico = $Servico->servico_descricao;
}

$buscarSolicitacaoSiscomVendas=mysql_query("SELECT * FROM siscom_vendas WHERE siscom = '$id_solicitacao' AND revisao = $revisao");

if(mysql_affected_rows() > 0)
{
	$fonte = "siscom_vendas";	
	$SolicitacaoTramitacaoSiscom = $SolicitacaoTramitacaoSiscom->buscaDadosSiscomVendas($SolicitacaoTramitacaoSiscom, $id_solicitacao, $revisao);
}

$Produto = new Produto();
$Produto = $Produto->buscaProdutoByDescricao($Produto, $SolicitacaoTramitacaoSiscom->produto);

$idproduto = $Produto->id_produto;
$descricaoProduto = $Produto->descricao;

$SolicitacaoTramitacaoSiscom->id_solicitacao = $id_solicitacao;
$SolicitacaoTramitacaoSiscom->revisao = $revisao;


?>

<div id="div_form_tramitacao" class="bradius wrapper" style="margin-left: 25%;" >
	<form 
		action="principal.php?t=Controller/TramitacaoController.php" method="POST">
		<fieldset id="fieldset_style">
			<input type="hidden" value="<?php echo $cripto->codificar($id_usuario)?>" name="id_usuario" id="id_usuario"></input>
			<input type="hidden" value="<?php echo $revisao?>" name="revisao" id="revisao"></input>
			<input type="hidden" value="<?php echo $id_solicitacao?>" name="id_solicitacao" id="id_solicitacao"></input>
			<input type="hidden" value="<?php echo $fonte ?>" name="fonte">
			<input type="hidden" value="insereSolicitacaoTramitacao" name="opcao" id="opcao"></input>
			<h2>Tramitação</h2> 
			<table id="form_tramitacao">
				<tr>
					<td>
						<div class="div_forms">
							<label>Siscom</label>
							<input 
								type="text" 
								id="siscom"  
								name="siscom"
								size= "50"
								required
								value="<?php echo $id_solicitacao?>" 
								class="campos_desabilitados"
								disabled
							/>
						</div>
					</td>
					<td>
						<div class="div_forms">
							<label>Data Entrada Siscom</label>
							<input 
								type="text"
								id="data_entrada_siscom"
								name="data_entrada_siscom" 
								value="<?php echo $SolicitacaoTramitacaoSiscom->dataEntradaSiscom?>" 
								class="campos_desabilitados"
								disabled
							>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div class="div_forms">
							<label>Canal de entrada*</label>
							<select 
								name="canal_entrada" 
								id="canal_entrada" 
								class="txt2comboboxpadrao bradius campos_desabilitados"
								required
								disabled
								>
								<option value="14">Siscom</option>
						  	</select>
						</div>
					</td>
					<td>
						<div class="div_forms">
							<label>Produto*</label>
							<select name="produto" id="produto"	disabled class="txt2comboboxpadrao campos_desabilitados">
								<option value="<?php echo $id_produto?>"><?php echo $descricaoProduto?></option>
						  	</select>
						</div>
					</td>
				</tr>
				<tr>
					
					<td>
						<div class="div_forms">
							<label>Serviço*</label>
							<?php if($fonte == "siscom_servico"){?>
							<select name="servico" disabled	class="txt2comboboxpadrao campos_desabilitados">
								<option value="<?php echo $idservico?>"><?php echo $descricaoServico?></option>
							</select>	
							<?php }else if($fonte == "siscom_vendas"){?> 
								<select name="servico" id="servico" class="txt2comboboxpadrao bradius" required>
									<option></option>
									<?php 
										$servicos=mysql_query("SELECT id_servicos, UPPER(descricao) as descricao FROM servicos order by descricao");

										while($rowserv=mysql_fetch_array($servicos)){
						                     
						        	?>
							        	<option value="<?php echo $rowserv['id_servicos']; ?>">
								   			<?php echo $rowserv['descricao']; ?>
								   		</option>
					   		<?php 
			          					}
          					}
		     				?>
						  	</select>
						</div>
					</td>
					<td>
						<div class="div_forms">
							<label>Complemento Serviço</label>
							<input 
								type="text" 
								id="complemento_servico"  
								name="complemento_servico"
								required 
							/>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div class="div_forms">
							<label>CNPJ/CPF*</label>
							<input 
								type="text" 
								id="cnpj_cpf"  
								name="cnpj_cpf"
								required
								disabled
								class="campos_desabilitados"
								value="<?php echo $SolicitacaoTramitacaoSiscom->cnpj?>" 
							/>
						</div>
					</td>
					<td>
						<div class="div_forms">
							<label>Razão Social*</label>
							<input 
								type="text" 
								id="razao_social"  
								name="razao_social"
								size= "100"
								required
								disabled
								class="campos_desabilitados"
								value="<?php echo $SolicitacaoTramitacaoSiscom->razaoSocial?>" 
							/>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div class="div_forms">
							<label>Escritório do GN</label>
							<input 
								type="text"
								id="escritorio_gn"
								name="escritorio_gn" 
								class="campos_desabilitados" 
								value="<?php echo $SolicitacaoTramitacaoSiscom->escritorio_gn?>" 
								disabled
							>
						</div>
					</td>
					<td>
						<div class="div_forms">
							<label>Quantidade de acessos*</label>
							<input 
								type="text" 
								id="qtd_acessos"  
								name="qtd_acessos"
								onblur="validaIntFields(this)";
								required
								class="txt2comboboxpadrao" 
							/>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div class="div_forms">
							<label>Nº Oportunidade e Proposta*</label>
							<input 
								type="text" 
								id="n_oport_proposta"  
								class="txt2comboboxpadrao" 
								name="n_oport_proposta"
								required
							/> 
						</div>
					</td>		
					<td>
						<div class="div_forms">
							<label id="data_encerramento_label">Data de Encerramento*</label>
							<input 
								type="text"
								id="data_encerramento"
								name="data_encerramento" 
								class="campoData" 
								onblur = "validaData(this)";
								required
							>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div class="div_forms">
							<label>Status*</label>
							<select 
								name="status_solicitacao_tramitacao" 
								id="status_solicitacao_tramitacao" 
								class="txt2comboboxpadrao bradius"
								required
								>
								<option></option>
								<?php 
						         	
									$statuss=mysql_query("SELECT * FROM status_solicitacao WHERE id_status_solicitacao IN(23,25,12,26,27) ORDER BY descricao");
							        
							         		
									while($rowss=mysql_fetch_array($statuss)){
					                     
					        	?>
					        	<option value="<?php echo $rowss['id_status_solicitacao']; ?>">
						   			<?php echo $rowss['descricao']; ?>
						   		</option>
						   		<?php 
			          				}
			     				?>
		     				</select>
						</div>
					</td>
					<td>
						<div class="div_forms">
							<label>Observações</label>
							<input 
								type="text" 
								id="obs"  
								class="txt2comboboxpadrao bradius" 
								name="obs"
							/> 
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div class="div_forms">
							<label>Área devolução</label>
							<select name="area_devolucao" id="area_devolucao" class="txt2comboboxpadrao bradius">
								<option value=""></option>
					   			<option value="COMERCIAL">COMERCIAL</option>
					   			<option value="TAREFA">TAREFA</option>
					  		</select>
				  		</div>	
					</td>
				</tr>
			</table>
			<br/>
			<input name="bt_enviar_form" id="bt_enviar_form" type="submit" value="Salvar" class="sb2 bradius" />
	 		<input name="cancelar" type="button" value="Cancelar" class="sb2 bradius" id="cancelar" onclick="history.back();" />
	 	</fieldset>
	</form>
</div>

  
    